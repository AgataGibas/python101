

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10.2. ToDo &mdash; Python 101 0.5 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
        <link rel="copyright" title="Copyright" href="../../copyright.html"/>
    <link rel="top" title="Python 101 0.5 documentation" href="../../index.html"/>
        <link rel="up" title="10. Aplikacje internetowe" href="../index.html"/>
        <link rel="next" title="10.3. Quiz ORM" href="../quiz_orm/index.html"/>
        <link rel="prev" title="10.1. Quiz" href="../quiz/index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> Python 101</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../env.html">System i oprogramowanie</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../env.html#system-operacyjny">System operacyjny</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../env.html#tryb-live">Tryb <em>live</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../env.html#rozruchowy-klucz-usb">Rozruchowy klucz USB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../env.html#windows-8-i-bios-uefi">Windows 8 i BIOS UEFI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../env.html#interpreter-pythona">Interpreter Pythona</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../env.html#edytory-ide-kodu">Edytory (IDE) kodu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../env.html#materialy">Materiały</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../source_code.html">Przygotowanie katalogu projektu</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../source_code.html#pobieranie-materialow">Pobieranie materiałów</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../source_code.html#korzystanie-z-kodu-zrodlowego-w-opisie-przykladow">Korzystanie z kodu źródłowego w opisie przykładów</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../source_code.html#synchronizacja-kodu-pomiedzy-etapami-przykladow">Synchronizacja kodu pomiędzy etapami przykładów</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../basic/basic.html">1. Python - Podstawy programowania</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html#zrodla">1.1. Źródła</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html#zmienne">1.2. Zmienne</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html#wyrazenia-warunkowe">1.3. Wyrażenia warunkowe</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html#gra-w-zgadnij-liczbe">1.4. Gra w &#8220;zgadnij liczbę&#8221;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html#zadania-dodatkowe">1.5. Zadania dodatkowe</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html#petla-while">1.6. Pętla WHILE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html#wyrazenia-break-i-continue">1.7. Wyrażenia break i continue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html#petla-for">1.8. Pętla FOR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic.html#slowniczek">1.9. Słowniczek</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../basic/basic1.html">2. Python w przykładach</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic1.html#jestem-python">2.1. Jestem Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic1.html#przywitaj-sie">2.2. Przywitaj się</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../basic/basic2.html">3. Warunki i pętle</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic2.html#trzy-liczby">3.1. Trzy liczby</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic2.html#wydrukuj-alfabet">3.2. Wydrukuj alfabet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../basic/basic3.html">4. Listy, tuple i funkcje</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic3.html#pobierz-n-liczb">4.1. Pobierz <em>n</em> liczb</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic3.html#ciag-fibonacciego">4.2. Ciąg Fibonacciego</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../basic/basic4.html">5. Zbiory i słowniki</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic4.html#oceny-z-przedmiotow">5.1. Oceny z przedmiotów</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic4.html#slownik-slowek">5.2. Słownik słówek</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../basic/basic5.html">6. Znam Pythona?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic5.html#trojkat">6.1. Trójkąt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic5.html#szyfr-cezara">6.2. Szyfr Cezara</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../basic/basic6.html">7. Nie znam Pythona... jeszcze</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic6.html#operatory-i">7.1. Operatory <strong>*</strong> i <strong>**</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic6.html#iteratory">7.2. Iteratory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic6.html#generatory-wyrazen">7.3. Generatory wyrażeń</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic6.html#wyrazenia-listowe">7.4. Wyrażenia listowe</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic6.html#generatory">7.5. Generatory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic6.html#pliki">7.6. Pliki</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basic/basic6.html#materialy-w-sieci">7.7. Materiały w sieci</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pygame/index.html">8. Gry w Pythonie</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pygame/pong_str/index.html">8.1. Pong (str)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pygame/pong/index.html">8.2. Pong (obj)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pygame/tictactoe_str/index.html">8.3. Kółko i krzyżyk (str)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pygame/tictactoe/index.html">8.4. Kółko i krzyżyk (obj)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pygame/life_str/index.html">8.5. Życie Conwaya (str)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pygame/life/index.html">8.6. Życie Conwaya (obj)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pygame/index.html#materialy">8.7. Materiały</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../bazy/index.html">9. Bazy danych w Pythonie</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../bazy/index.html#sql">9.1. SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bazy/index.html#systemy-orm">9.2. Systemy ORM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../bazy/index.html#materialy">9.3. Materiały</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">10. Aplikacje internetowe</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../quiz/index.html">10.1. Quiz</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">10.2. ToDo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../quiz_orm/index.html">10.3. Quiz ORM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chatter/index.html">10.4. Chatter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#materialy">10.5. Materiały</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../git/git.html">Git - wersjonowanie kodów źródłowych</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#lokalne-repozytoria-z-historia-zmian">Lokalne repozytoria z historią zmian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#centrale-repozytoria-dostepne-przez-internet">Centrale repozytoria dostępne przez internet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#nowe-konto-github">Nowe konto GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#forkujemy-pierwszy-projekt">Forkujemy pierwszy projekt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#instalujemy-narzedzie-git">Instalujemy narzędzie GIT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#klonujemy-nasz-projekt-lokalnie">Klonujemy nasz projekt lokalnie</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#skok-do-wybranej-wersji-z-historii-zmian">Skok do wybranej wersji z historii zmian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#zmieniamy-i-zapisujemy-zmiany-w-lokalnym-repozytorium">Zmieniamy i zapisujemy zmiany w lokalnym repozytorium</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#wysylamy-zmiany-do-centralnego-repozytorium">Wysyłamy zmiany do centralnego repozytorium</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#przypisujemy-tagi-do-konkretnych-wersji-w-historii-zmian">Przypisujemy tagi do konkretnych wersji w historii zmian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#wysylamy-tagi-do-centralnego-repozytorium">Wysyłamy tagi do centralnego repozytorium</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../git/git.html#pobieramy-zmiany-z-centralnego-repozytorium">Pobieramy zmiany z centralnego repozytorium</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Python 101</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">10. Aplikacje internetowe</a> &raquo;</li>
      
    <li>10.2. ToDo</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../_sources/webapps/todo/index.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="todo">
<h1>10.2. ToDo<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h1>
<p>Realizacja prostej listy ToDo (lista zadań do zrobienia) jako aplikacji internetowej, z wykorzystaniem Pythona i frameworka Flask w wersji 0.10.1.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#struktura-katalogow" id="id2">Struktura katalogów</a></li>
<li><a class="reference internal" href="#szkielet-aplikacji" id="id3">Szkielet aplikacji</a></li>
<li><a class="reference internal" href="#definiowanie-widokow" id="id4">Definiowanie widoków</a></li>
<li><a class="reference internal" href="#model-bazy-danych" id="id5">Model bazy danych</a></li>
<li><a class="reference internal" href="#polaczenie-z-baza-danych" id="id6">Połączenie z bazą danych</a></li>
<li><a class="reference internal" href="#pobieranie-i-wyswietlanie-danych" id="id7">Pobieranie i wyświetlanie danych</a></li>
<li><a class="reference internal" href="#formularz-dodawania-zadan" id="id8">Formularz dodawania zadań</a></li>
<li><a class="reference internal" href="#wyglad-aplikacji-opcja" id="id9">Wygląd aplikacji (opcja)</a></li>
<li><a class="reference internal" href="#zadania-wykonane-opcja" id="id10">Zadania wykonane (opcja)</a></li>
<li><a class="reference internal" href="#materialy" id="id11">Materiały</a></li>
</ul>
</div>
<div class="section" id="struktura-katalogow">
<h2><a class="toc-backref" href="#id2">10.2.1. Struktura katalogów</a><a class="headerlink" href="#struktura-katalogow" title="Permalink to this headline">¶</a></h2>
<p>Zaczynamy od utworzenia katalogu projektu ToDo w katalogu domowym użytkownika, a w nim pliku <code class="file docutils literal"><span class="pre">todo.py</span></code>:</p>
<div class="code_no">Terminal nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-bash"><div class="highlight"><pre>~ <span class="nv">$ </span>mkdir todo; <span class="nb">cd </span>todo; touch todo.py
</pre></div>
</div>
<p>Aplikacja ma pozwalać na dodawanie z określoną datą, przeglądanie i oznaczanie jako wykonane różnych zadań, które zapisywane będą w bazie danych SQLite.</p>
</div>
<div class="section" id="szkielet-aplikacji">
<h2><a class="toc-backref" href="#id3">10.2.2. Szkielet aplikacji</a><a class="headerlink" href="#szkielet-aplikacji" title="Permalink to this headline">¶</a></h2>
<p>Utworzenie minimalnej aplikacji Flask pozwoli na uruchomienie serwera deweloperskiego, umożliwiającego wygodne rozwijanie kodu. W pliku <code class="file docutils literal"><span class="pre">todo.py</span></code> wpisujemy:</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="c"># todo/todo.py</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Serwer uruchamiamy komendą: <code class="docutils literal"><span class="pre">python</span> <span class="pre">todo.py</span></code></p>
<div class="figure">
<img alt="../../_images/serwerrun.png" src="../../_images/serwerrun.png" />
</div>
<p>Domyślnie serwer uruchamia się pod adresem <em>127.0.0.1:5000</em>. Po wpisaniu adresu do przeglądarki internetowej
otrzymamy stronę z błędem HTTP 404, ponieważ nasza aplikacja
nie ma jeszcze zdefiniowanego żadnej odpowiedzi dla tego adresu.
Odpowiedź taka, tzw. <a class="reference internal" href="#term-widok"><em class="xref std std-term">widok</em></a>, to funkcja obsługująca wywołania powiązanego z nim adresu.
Widok (funkcja) zwraca najczęściej użytkownikowi wyrenderowaną z szablonu stronę internetową.</p>
<div class="figure">
<img alt="../../_images/notfound.png" src="../../_images/notfound.png" />
</div>
</div>
<div class="section" id="definiowanie-widokow">
<h2><a class="toc-backref" href="#id4">10.2.3. Definiowanie widoków</a><a class="headerlink" href="#definiowanie-widokow" title="Permalink to this headline">¶</a></h2>
<p>W pliku <code class="file docutils literal"><span class="pre">todo.py</span></code> umieścimy funkcję <code class="docutils literal"><span class="pre">index()</span></code>, domyślny widok naszej strony:</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="c"># todo/todo.py</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c"># dekorator laczacy adres glowny z widokiem index</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;Witaj na moim serwerze!&#39;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Widok <code class="docutils literal"><span class="pre">index()</span></code> za pomocą dekoratora związaliśmy z adresem głównym (/). Po odświeżeniu adresu <em>127.0.0.1:5000</em> zamiast błędu powinniśmy zobaczyć napis: &#8220;Witaj na moim serwerze!&#8221;</p>
</div>
<div class="section" id="model-bazy-danych">
<h2><a class="toc-backref" href="#id5">10.2.4. Model bazy danych</a><a class="headerlink" href="#model-bazy-danych" title="Permalink to this headline">¶</a></h2>
<p>W katalogu aplikacji tworzymy plik <code class="file docutils literal"><span class="pre">schema.sql</span></code>, który zawiera opis struktury tabeli z zadaniami. Do tabeli wprowadzimy przykładowe dane.</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre>-- todo/schema.sql

-- tabela z zadaniami
drop table if exists entries;
create table entries (
    id integer primary key autoincrement, -- unikalny indentyfikator
    title text not null, -- opis zadania do wykonania
    is_done boolean not null, -- informacja czy zadania zostalo juz wykonane
    created_at datetime not null -- data dodania zadania
);

-- pierwsze dane
insert into entries (id, title, is_done, created_at)
values (null, &#39;Wyrzucić śmieci&#39;, 0, datetime(current_timestamp));
insert into entries (id, title, is_done, created_at)
values (null, &#39;Nakarmić psa&#39;, 0, datetime(current_timestamp));
</pre></div>
</td></tr></table></div>
<p>Tworzymy bazę danych w pliku <code class="file docutils literal"><span class="pre">db.sqlite</span></code>, łączymy się z nią i próbujemy wyświetlić dane, które powinny były zostać zapisane w tabeli <em>entries</em>:</p>
<div class="code_no">Terminal nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-bash"><div class="highlight"><pre>sqlite3 db.sqlite &lt; schema.sql
sqlite3 db.sqlite
<span class="k">select</span> <span class="se">\*</span> from entries;
</pre></div>
</div>
<div class="figure">
<img alt="../../_images/sqlite.png" src="../../_images/sqlite.png" />
</div>
<p>Pracę z bazą kończymy poleceniem <code class="docutils literal"><span class="pre">.quit</span></code>.</p>
</div>
<div class="section" id="polaczenie-z-baza-danych">
<h2><a class="toc-backref" href="#id6">10.2.5. Połączenie z bazą danych</a><a class="headerlink" href="#polaczenie-z-baza-danych" title="Permalink to this headline">¶</a></h2>
<p>Bazę danych już mamy, teraz pora napisać funkcje umożiwiające łączenie się z nią z poziomu naszej aplikacji. W pliku <code class="file docutils literal"><span class="pre">todo.py</span></code> dodajemy:</p>
<div class="code_no">Terminal nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>
<span class="c"># todo/todo.py</span>

<span class="c"># importujemy biblioteki potrzebne do nawiązania połączenia z baza</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">g</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c"># konfiguracja aplikacji</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
    <span class="c"># nieznany nikomu sekret dla mechanizmu sesji</span>
    <span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="s">&#39;bardzosekretnawartosc&#39;</span><span class="p">,</span>
    <span class="c"># polozenie naszej bazy</span>
    <span class="n">DATABASE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="s">&#39;db.sqlite&#39;</span><span class="p">),</span>
    <span class="c"># nazwa aplikacji</span>
    <span class="n">SITE_NAME</span> <span class="o">=</span> <span class="s">&#39;Moja lista ToDo&#39;</span>
<span class="p">))</span>

<span class="k">def</span> <span class="nf">connect_db</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Nawiazywanie połaczenia z bazą danych określoną w konfiguracji.&quot;&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot;http://flask.pocoo.org/docs/0.10/patterns/sqlite3/&quot;&quot;&quot;</span>
    <span class="n">rv</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;DATABASE&#39;</span><span class="p">])</span>
    <span class="n">rv</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
    <span class="k">return</span> <span class="n">rv</span>

<span class="k">def</span> <span class="nf">get_db</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Funkcja pomocnicza, ktora tworzy połączenia z bazą przy pierwszym</span>
<span class="sd">    wywołaniu i umieszcza ja w kontekście aplikacji (obiekt g). W kolejnych</span>
<span class="sd">    wywołaniach zwraca połączenie z kontekstu.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s">&#39;db&#39;</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">connect_db</span><span class="p">()</span> <span class="c"># jezeli kontekst nie zawiera informacji o polaczeniu to je tworzymy</span>
    <span class="k">return</span> <span class="n">g</span><span class="o">.</span><span class="n">db</span> <span class="c"># zwracamy polaczenie z baza</span>

<span class="c"># dekorator wykonujacy funkcje po wyslaniu odpowiedzi do klienta</span>
<span class="nd">@app.teardown_request</span>
<span class="k">def</span> <span class="nf">close_db</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Zamykanie polaczenia z baza.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="s">&#39;db&#39;</span><span class="p">):</span>
        <span class="n">g</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c"># dekorator laczacy adres glowny z widokiem index</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;Hello, SWOI&#39;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Dodaliśmy sekretny klucz zabezpieczający mechanizm sesji, ustawiliśmy ścieżkę do pliku bazy danych w katalogu aplikacji (stąd użycie funkcji <code class="docutils literal"><span class="pre">app.root_path</span></code>) oraz nazwę aplikacji. Utworzyliśmy trzy funkcje odpowiedzialne za nawiązywanie (<code class="docutils literal"><span class="pre">connect_db</span></code>, <code class="docutils literal"><span class="pre">get_db</span></code>) i kończenie (<code class="docutils literal"><span class="pre">close_db</span></code>) połączenia z bazą danych.</p>
</div>
<div class="section" id="pobieranie-i-wyswietlanie-danych">
<h2><a class="toc-backref" href="#id7">10.2.6. Pobieranie i wyświetlanie danych</a><a class="headerlink" href="#pobieranie-i-wyswietlanie-danych" title="Permalink to this headline">¶</a></h2>
<p>Wyświetlanie danych umożliwia wbudowany we Flask system szablonów (templatek), czyli mechanizm renderowania kodu HTML na podstawie plików zawierających instrukcje wstawiające wybrane dane z aplikacji oraz znaczniki HTML. Modyfikujemy funkcję <code class="docutils literal"><span class="pre">index()</span></code> w pliku <code class="file docutils literal"><span class="pre">todo.py</span></code>:</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-python"><div class="highlight"><pre><span class="c"># dodajemy nowe importy do pozostalych</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span>

<span class="c"># dekorator laczacy adres glowny z widokiem index</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span> <span class="c"># laczymy sie z baza</span>
    <span class="c"># pobieramy wszystkie wpisy z bazy:</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select id, title, is_done, created_at from entries order by created_at desc;&#39;</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="c"># renderujemy tempaltke i zwracamy ja do klienta</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;show_entries.html&#39;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="n">entries</span><span class="p">)</span>
</pre></div>
</div>
<p>W widoku <code class="docutils literal"><span class="pre">index()</span></code> pobieramy obiekt bazy danych (<cite>db</cite>) i wykonujemy zapytanie (<cite>select...</cite>), by wyciągnąć wszystkie zapisane zadania. Na koniec renderujemy szablon przekazując do niego pobrane zadania (<code class="docutils literal"><span class="pre">entries</span></code>). Szablon, czyli plik <code class="file docutils literal"><span class="pre">show_entries.html</span></code>, umieszczamy w podkatalogu <code class="file docutils literal"><span class="pre">templates</span></code> aplikacji. Poniżej jego zawartość:</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre>&lt;!-- todo/templates/show_entries.html --&gt;
&lt;html&gt;
    &lt;head&gt;
    &lt;!-- automatycznie przekazana informacja z konfiguracji aplikacji --&gt;
        &lt;title&gt;{{ config.SITE_NAME }}&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;{{ config.SITE_NAME }}:&lt;/h1&gt;
        &lt;ol&gt;
            &lt;!-- wypisujemy kolejno wszystkie zdania --&gt;
            {% for entry in entries %}
                &lt;li&gt;
                    {{ entry.title }}&lt;em&gt;{{ entry.created_at }}&lt;/em&gt;
                &lt;/li&gt;
            {% endfor %}
        &lt;/ol&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre></div>
</td></tr></table></div>
<p>Wewnątrz szablonu przeglądamy wszystkie wpisy (<cite>entries</cite>) i umieszczamy je na liście HTML. Do szablonu automatycznie przekazywany jest obiekt <code class="docutils literal"><span class="pre">config</span></code> (dane konfiguracyjne), z którego pobieramy tytuł strony (<cite>SITE_NAME</cite>). Po odwiedzeniu strony <em>127.0.0.1:5000</em> powinniśmy zobaczyć listę zadań.</p>
<div class="figure">
<img alt="../../_images/listatodo1.png" src="../../_images/listatodo1.png" />
</div>
</div>
<div class="section" id="formularz-dodawania-zadan">
<h2><a class="toc-backref" href="#id8">10.2.7. Formularz dodawania zadań</a><a class="headerlink" href="#formularz-dodawania-zadan" title="Permalink to this headline">¶</a></h2>
<p>Aby umożliwić dodawanie i zapisywanie w bazie nowych zadań, modyfikujemy widok <code class="docutils literal"><span class="pre">index()</span></code>, tak aby obsługiwał żądania POST, które zawierają dane wysłane z formularza na serwer.</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-python"><div class="highlight"><pre><span class="c"># dodajemy importy</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">flash</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">request</span>

<span class="c"># dekorator laczacy adres glowny z widokiem index</span>
<span class="c"># poza powiazaniem adresu / z funkcja index, dodajemy mozliwosc akcpetacji</span>
<span class="c"># zadan HTTP POST (domyslnie dozwolone sa tyko zadania GET)</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Glowny widok strony. Obsluguje wyswietlanie i dodawanie zadan.&quot;&quot;&quot;</span>
    <span class="c"># zmienna przechowujaca informacje o ewentualnych bledach</span>
    <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c"># jezeli otrzymujemy dane POST z formularza, dodajemy nowe zadanie</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">&#39;POST&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;entry&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># sprawdzamy poprawnosc przeslanych danych</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span> <span class="c"># nawiazujemy polaczenie z baza danych</span>
            <span class="n">new_entry</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;entry&#39;</span><span class="p">]</span> <span class="c"># wyciagamy tresc zadania z przeslanego formularza</span>
            <span class="n">is_done</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span> <span class="c"># ustalamy, ze nowo dodane zadanie nie jest jeszcze wykonane</span>
            <span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="c"># data dodania</span>
            <span class="c"># zapytanie do bazy, ktore wstawia nowy wiersz z danymi</span>
            <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;insert into entries (title, is_done, created_at) values (?, ?, ?);&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">new_entry</span><span class="p">,</span> <span class="n">is_done</span><span class="p">,</span> <span class="n">created_at</span><span class="p">])</span>
            <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span> <span class="c"># wykonujemy zapytanie</span>
            <span class="n">flash</span><span class="p">(</span><span class="s">&#39;Dodano nowe zadanie&#39;</span><span class="p">)</span> <span class="c"># informacja o pomyslnym dodaniu nowego zadania</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span> <span class="c"># przekierowujemy na strone glowna</span>
        <span class="n">error</span> <span class="o">=</span> <span class="s">u&#39;Nie możesz dodać pustego zadania&#39;</span> <span class="c"># komunikat o bledzie</span>

    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span> <span class="c"># laczymy sie z baza</span>
    <span class="c"># pobieramy wszystkie wpisy z bazy:</span>
    <span class="n">cur</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;select id, title, is_done, created_at from entries order by created_at desc;&#39;</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="c"># renderujemy tempaltke i zwracamy do klienta:</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">&#39;show_entries.html&#39;</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="n">entries</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Wpisując adres w polu adresu przeglądarki, wysyłamy do serwera żądanie typu GET, które obsługujemy zwracając klientowi odpowiednie dane (listę zadań). Natomiast żądania typu POST są wykorzystywane do zmiany informacji na serwerze (np. dodania nowego wpisu). Dlatego widok <code class="docutils literal"><span class="pre">index()</span></code> rozszerzyliśmy o sprawdzanie typu żądania, w razie wykrycia danych POST, sprawdzamy poprawność danych przesłanych z formularza i jeżeli są poprawne, dodajemy nowe zadanie do bazy. W przeciwnym razie zwracamy użytkownikowi informację o błędzie.
Szablon <code class="file docutils literal"><span class="pre">show_entries.html</span></code> aktualizujemy, dodając odpowiedni formularz:</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre>&lt;!-- todo/templates/show_entries.html --&gt;
&lt;html&gt;
    &lt;head&gt;
    &lt;!-- automatycznie przekazana informacja z konfiguracji aplikacji --&gt;
        &lt;title&gt;{{ config.SITE_NAME }}&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;{{ config.SITE_NAME }}:&lt;/h1&gt;
        &lt;!-- formularz dodawania zadania --&gt;
        &lt;form class=&quot;add-form&quot; method=&quot;POST&quot; action=&quot;{{ url_for(&#39;index&#39;) }}&quot;&gt;
            &lt;input name=&quot;entry&quot; value=&quot;&quot;/&gt;
            &lt;button type=&quot;submit&quot;&gt;Dodaj zadanie&lt;/button&gt;
        &lt;/form&gt;

        &lt;!-- informacje o sukcesie lub bledzie --&gt;
        &lt;p&gt;
            {% if error %}
                &lt;strong class=&quot;error&quot;&gt;Błąd: {{ error }}&lt;/strong&gt;
            {% endif %}

            {% for message in get_flashed_messages() %}
                &lt;strong class=&quot;success&quot;&gt;{{ message }}&lt;/strong&gt;
            {% endfor %}
        &lt;/p&gt;
        &lt;ol&gt;
            &lt;!-- wypisujemy kolejno wszystkie zdania --&gt;
            {% for entry in entries %}
                &lt;li&gt;
                    {{ entry.title }}&lt;em&gt;{{ entry.created_at }}&lt;/em&gt;
                &lt;/li&gt;
            {% endfor %}
        &lt;/ol&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre></div>
</td></tr></table></div>
<p>W szablonie dodaliśmy formularz oraz informację o błędzie lub sukcesie przy próbie dodawania zadania. Określając atrybut <em>action</em> w formularzu, skorzystaliśmy z wbudowanej funkcji <code class="docutils literal"><span class="pre">url_for</span></code>, która zamienia nazwę widoku (w tym wypadku <code class="docutils literal"><span class="pre">index</span></code>) na odpowiadający jej adres URL (w tym wypadku <code class="docutils literal"><span class="pre">/</span></code>). W ten sposób łączymy formularz z konkretną funkcją Pythonową (widokiem), która obsługuje dany adres.</p>
<div class="figure">
<img alt="../../_images/listatodo2.png" src="../../_images/listatodo2.png" />
</div>
</div>
<div class="section" id="wyglad-aplikacji-opcja">
<h2><a class="toc-backref" href="#id9">10.2.8. Wygląd aplikacji (opcja)</a><a class="headerlink" href="#wyglad-aplikacji-opcja" title="Permalink to this headline">¶</a></h2>
<p>Wygląd aplikacji możemy zdefiniować w arkuszu stylów CSS o nazwie <code class="file docutils literal"><span class="pre">style.css</span></code>, który zapisujemy w podkatalogu <code class="file docutils literal"><span class="pre">static</span></code> aplikacji:</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre>/* todo/static/style.css */

body { margin-top: 20px; }
h1, p { margin-left: 20px; }
.add-form { margin-left: 20px; }
ol { text-align: left; }
em { font-size: 11px; margin-left: 10px; }
form { display: inline-block; margin-bottom: 0;}
input[name=&quot;entry&quot;] { width: 300px; }
input[name=&quot;entry&quot;]:focus {
    border-color: blue;
    border-radius: 5px;
}
li { margin-bottom: 5px; }
button {
    padding: 0;
    cursor: pointer;
    font-size: 11px;
    background: white;
    border: none;
    color: blue;
}
.error { color: red; }
.success { color: green; }
.done { text-decoration: line-through; }
</pre></div>
</td></tr></table></div>
<p>Zdefiniowane style podpinamy do pliku <code class="file docutils literal"><span class="pre">show_entries.html</span></code>, dodając w sekcji head wpis &lt;link... &gt;:</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>{{ config.SITE_NAME }}<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">href=</span><span class="s">&quot;{{ url_for(&#39;static&#39;, filename=&#39;style.css&#39;) }}&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
</pre></div>
</div>
<p>Dzięki temu nasza aplikacja nabierze nieco lepszego wyglądu.</p>
<div class="figure">
<img alt="../../_images/listatodo3.png" src="../../_images/listatodo3.png" />
</div>
</div>
<div class="section" id="zadania-wykonane-opcja">
<h2><a class="toc-backref" href="#id10">10.2.9. Zadania wykonane (opcja)</a><a class="headerlink" href="#zadania-wykonane-opcja" title="Permalink to this headline">¶</a></h2>
<p>Do każdego zadania dodamy formularz, którego wysłanie będzie oznaczało, że wykonaliśmy dane zadanie, czyli zmienimy atrybut <code class="docutils literal"><span class="pre">is_done</span></code> wpisu z <em>0</em> (niewykonane) na <em>1</em> (wykonane). Odpowiednie żądanie typu POST obsłuży nowy widok w pliku <code class="file docutils literal"><span class="pre">todo.py</span></code>. W szablonie <code class="file docutils literal"><span class="pre">show_entries.html</span></code> dodamy kod wyróżniający zadania wykonane.</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-python"><div class="highlight"><pre><span class="c"># dodajemy ponad definicja if __main__(...)</span>

<span class="c"># nadajemy osobny adres, oraz zezwalamy jedynie na zadania typu POST</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/mark_as_done&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">mark_as_done</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Zmiana statusu zadania na wykonane.&quot;&quot;&quot;</span>
    <span class="c"># z przeslanego formularza pobieramy identyfikator zadania</span>
    <span class="n">entry_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
    <span class="n">db</span> <span class="o">=</span> <span class="n">get_db</span><span class="p">()</span> <span class="c"># laczymy sie z baza danych</span>
    <span class="c"># przygotowujemy zapytanie aktualizujace pole is_done zadania o danym identyfikatorze</span>
    <span class="n">db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&#39;update entries set is_done=1 where id=?&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">entry_id</span><span class="p">,])</span>
    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span> <span class="c"># zapisujemy nowe dane</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">))</span> <span class="c"># na koniec przekierowujemy na liste wszystkich zadan</span>
</pre></div>
</div>
<p>W szablonie <code class="file docutils literal"><span class="pre">show_entries.html</span></code> modyfikujemy fragment wyświetlający listę zadań i dodajemy formularz:</p>
<div class="code_no">Kod nr <script>var code_no = code_no || 1; document.write(code_no++);</script></div><div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;ol&gt;</span>
    {% for entry in entries %}
        <span class="nt">&lt;li&gt;</span>
            <span class="c">&lt;!-- dodatkowe dekoracje dla zadan zakonczonych --&gt;</span>
            {% if entry.is_done %}
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;done&quot;</span><span class="nt">&gt;</span>
            {% endif %}

            {{ entry.title }}<span class="nt">&lt;em&gt;</span>{{ entry.created_at }}<span class="nt">&lt;/em&gt;</span>

            <span class="c">&lt;!-- dodatkowe dekoracje dla zadan zakonczonych --&gt;</span>
            {% if entry.is_done %}
                <span class="nt">&lt;/span&gt;</span>
            {% endif %}

            <span class="c">&lt;!-- formularz zmiany statusu zadania --&gt;</span>
            {% if not entry.is_done %}
                <span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;POST&quot;</span> <span class="na">action=</span><span class="s">&quot;{{ url_for(&#39;mark_as_done&#39;) }}&quot;</span><span class="nt">&gt;</span>
                    <span class="c">&lt;!-- wysylamy jedynie informacje o id zadania --&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;id&quot;</span> <span class="na">value=</span><span class="s">&quot;{{ entry.id }}&quot;</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;</span>Wykonane<span class="nt">&lt;/button&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            {% endif %}
        <span class="nt">&lt;/li&gt;</span>
    {% endfor %}
<span class="nt">&lt;/ol&gt;</span>
</pre></div>
</div>
<p>Aplikację można uznać za skończoną. Możemy dodawać zadania oraz zmieniać ich status.</p>
<div class="figure">
<img alt="../../_images/listatodo4.png" src="../../_images/listatodo4.png" />
</div>
<div class="section" id="zadania-dodatkowe">
<h3>10.2.9.1. Zadania dodatkowe<a class="headerlink" href="#zadania-dodatkowe" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>Dodaj możliwość usuwania zadań.
Dodaj mechanizm logowania użytkownika tak, aby użytkownik mógł dodawać i edytować tylko swoją listę zadań.
Wprowadź osobne listy zadań dla każdego użytkownika.</div></blockquote>
</div>
</div>
<div class="section" id="materialy">
<h2><a class="toc-backref" href="#id11">10.2.10. Materiały</a><a class="headerlink" href="#materialy" title="Permalink to this headline">¶</a></h2>
<div class="section" id="slownik">
<h3>10.2.10.1. Słownik<a class="headerlink" href="#slownik" title="Permalink to this headline">¶</a></h3>
<dl class="glossary docutils">
<dt id="term-aplikacja">aplikacja</dt>
<dd>program komputerowy.</dd>
<dt id="term-framework">framework</dt>
<dd>zestaw komponentów i bibliotek wykorzystywany do budowy aplikacji,
przykładem jest biblioteka Pythona Flask.</dd>
<dt id="term-html">HTML</dt>
<dd>język znaczników wykorzystywany do formatowania dokumentów, zwłaszcza stron WWW.</dd>
<dt id="term-css">CSS</dt>
<dd>język służący do opisu formy prezentacji stron WWW.</dd>
<dt id="term-http">HTTP</dt>
<dd>protokół przesyłania dokumentów WWW.</dd>
<dt id="term-get">GET</dt>
<dd>typ żądania HTTP, służący do pobierania zasobów z serwera WWW.</dd>
<dt id="term-post">POST</dt>
<dd>typ żądania HTTP, służący do umieszczania zasobów na serwerze WWW.</dd>
<dt id="term-logowanie">logowanie</dt>
<dd>proces autoryzacji i uwierzytelniania użytkownika w systemie.</dd>
<dt id="term-orm">ORM</dt>
<dd>mapowanie obiektowo-relacyjne, oprogramowanie służące do przekształcania struktur bazy danych na obiekty klasy danego języka oprogramowania.</dd>
<dt id="term-serwer-deweloperski-testowy">serwer deweloperski (testowy)</dt>
<dd>serwer www używany w czasie prac nad oprogramowaniem.</dd>
<dt id="term-serwer-www">serwer WWW</dt>
<dd>serwer obsługujący protokół HTTP.</dd>
<dt id="term-baza-danych">baza danych</dt>
<dd>program przeznaczony do przechowywania i przetwarzania danych.</dd>
<dt id="term-szablon">szablon</dt>
<dd>wzorzec (nazywany czasem templatką) strony WWW wykorzystywany do renderowania widoków.</dd>
<dt id="term-url">URL</dt>
<dd>ustandaryzowany format adresowania zasobów w internecie (<a class="reference external" href="http://pl.wikipedia.org/wiki/Uniform_Resource_Locator">przykład</a>).</dd>
<dt id="term-model">model</dt>
<dd>schematy i źródła danych aplikacji.</dd>
<dt id="term-widok">widok</dt>
<dd>we Flasku lub Django jest to funkcja, która obsługuje żądania wysyłane przez użytkownika
i na ich podstawie przygotowuje dane zwracane do przeglądarki, najczęściej  w formie strony WWW.</dd>
<dt id="term-kontroler">kontroler</dt>
<dd>logika aplikacji, w Django zawarta w funkcji obsługującej widok.</dd>
</dl>
<ol class="arabic simple">
<li>Strona projektu Flask <a class="reference external" href="http://flask.pocoo.org/">http://flask.pocoo.org/</a></li>
<li>Informacje o SQLite <a class="reference external" href="http://pl.wikipedia.org/wiki/SQLite">http://pl.wikipedia.org/wiki/SQLite</a></li>
<li>Co to jest framework? <a class="reference external" href="http://pl.wikipedia.org/wiki/Framework">http://pl.wikipedia.org/wiki/Framework</a></li>
<li>Co nieco o HTTP i żądaniach GET i POST <a class="reference external" href="http://pl.wikipedia.org/wiki/Http">http://pl.wikipedia.org/wiki/Http</a></li>
</ol>
</div>
<div class="section" id="zrodla">
<h3>10.2.10.2. Źródła<a class="headerlink" href="#zrodla" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference download internal" href="../../_downloads/todo_all.zip"><code class="xref download docutils literal"><span class="pre">todo_all.zip</span></code></a></li>
<li><a class="reference download internal" href="../../_downloads/todo_flask_sqlite.pdf"><code class="xref download docutils literal"><span class="pre">todo_flask_sqlite.pdf</span></code></a></li>
</ul>
</div>
<div class="section" id="metryka">
<h3>10.2.10.3. Metryka<a class="headerlink" href="#metryka" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Autorzy:</th><td class="field-body">Robert Bednarz (<a class="reference external" href="mailto:ecg&#37;&#52;&#48;ecg&#46;vot&#46;pl">ecg<span>&#64;</span>ecg<span>&#46;</span>vot<span>&#46;</span>pl</a>), Tomasz Nowacki</td>
</tr>
<tr class="field-even field"><th class="field-name">Utworzony:</th><td class="field-body">2015-02-17 o 12:22</td>
</tr>
</tbody>
</table>
<style>
    div.code_no { text-align: right; background: #e3e3e3; padding: 6px 12px; }
    div.highlight, div.highlight-python { margin-top: 0px; }
</style><p>
    <a style="float:left; margin: 0.3em 1em 1em 0" rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
        <img alt="Licencja Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a>
    Materiały <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Python 101</span>
    udostępniane przez <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.ceo.org.pl/" property="cc:attributionName" rel="cc:attributionURL">
    Centrum Edukacji Obywatelskiej</a> na licencji <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
    Creative Commons Uznanie autorstwa-Na tych samych warunkach 4.0 Międzynarodowa</a>.<br />
</p>

<script>
  // dla http://koduj-z-klasa.github.io/python101/
  // w read the docs kod uzupełnia się w dashboardzie
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55172998-1', 'auto');
  ga('send', 'pageview');
</script></div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../quiz_orm/index.html" class="btn btn-neutral float-right" title="10.3. Quiz ORM"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../quiz/index.html" class="btn btn-neutral" title="10.1. Quiz"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; <a href="../../copyright.html">Copyright</a> 2014, Centrum Edukacji Obywatelskiej.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/custom.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>